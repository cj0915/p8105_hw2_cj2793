---
title: "p8105_hw2_cj2793"
author: "Chenyu Jin"
date: "2024-09-26"
output: github_document
---

# Problem 1

## Read and clean the data:

First, we should read the excel file:

```{r}
library(tidyverse)
transit_df = read_csv(file = "hw2data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv")
```

Then, we select the columns of interest:

```{r}
selected_transit_df <- transit_df |>
  select("Line", "Station Name", "Station Latitude", "Station Longitude", c("Route1":"Route11"), "Entry", "Vending", "Entrance Type", "ADA")
```

Next, we convert the entry variable from character (YES vs NO) to a logical variable:

```{r}
cleaned_transit_df <- selected_transit_df |>
  mutate(Entry = ifelse(Entry == "YES", TRUE, FALSE))
```


This data set contains information about entrances and exits for each subway station in the NYC transit system. The key variables include the subway line (Line), station name (Station Name), station location (Station Latitude, Station Longitude), routes served (Route1 ~ Route11), whether entry is permitted (Entry), vending machine availability (Vending), entrance type (Entrance Type), and ADA compliance (ADA). In the cleaning process, we selected these relevant columns from the original data set and converted the Entry variable from a character format (YES/NO) to a logical format (TRUE/FALSE). The resulting data set contains 19 columns and retains all 1868 original rows from the source data. The data set is tidy, as each variable is a column, each observation is a row, and each cell contains a single value.

## Answer the following questions using these data:

1. How many distinct stations are there?

```{r}
# We first create a new variable called 'Station', which is the full name of the Station, like '125th St 8th Avenue'

cleaned_transit_df <- cleaned_transit_df |>
  mutate(Station = paste(`Station Name`, Line, sep = " "))

distinct_stations <- cleaned_transit_df |>
  distinct(Station)

num_distinct_stations <- nrow(distinct_stations)

num_distinct_stations
```

There are 465 stations.

2. How many stations are ADA compliant?

```{r}
ada_status <- cleaned_transit_df |>
  filter(ADA == TRUE) |>
  nrow()

ada_status
```

There are 468 stations with ADA compliant.

3. What proportion of station entrances / exits without vending allow entrance?

```{r}
wihout_vending <- cleaned_transit_df |>
  filter(Vending == "NO")

entry_status <- wihout_vending |>
  filter(Entry == TRUE) |>
  nrow()

vending_status <- nrow(wihout_vending)

proportion <- entry_status / vending_status

proportion
```

Proportion of station entrances / exits without vending allow entrance is 37.70%.

## Reformat data and answer some questions about A train:

```{r}
cleaned_transit_df <- cleaned_transit_df |>
  mutate(across(starts_with("Route"), as.character))

long_data <- cleaned_transit_df |>
  pivot_longer(Route1:Route11, 
               names_to = "Route_Number", 
               values_to = "Route_Name") |>
  filter(!is.na(Route_Name))

# How many distinct stations serve the A train?
A_train_stations <- long_data |>
  filter(Route_Name == "A") |>
  distinct(Station) |>
  nrow()

A_train_stations

# Of the stations that serve the A train, how many are ADA compliant?
ada_status_A <- long_data |>
  filter(Route_Name == "A", ADA == TRUE) |>
  nrow()

ada_status_A
```

60 distinct stations serve the A train. Of the stations that serve the A train, 107 are ADA compliant.

# Problem 2

## Read and clean the Mr. Trash Wheel sheet:

```{r}
library(tidyverse)
library(readxl)

# specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
file_path <- "hw2data/202309 Trash Wheel Collection Data.xlsx"
Mr_trashwheel_data <- read_excel(file_path, sheet = "Mr. Trash Wheel", skip = 1)

# use reasonable variable names
colnames(Mr_trashwheel_data) <- c("Dumpster", "Month", "Year", "Date", "Weight", 
                          "Volume", "Plastic_Bottles", "Polystyrene", 
                          "Cigarette_Butts", "Glass_Bottles", "Plastic_Bags", 
                          "Wrappers", "Sports_Balls", "Homes_Powered", "Extra1", "Extra2")

Mr_trashwheel_data <- Mr_trashwheel_data[, -c(15, 16)] |>
  # omit rows that do not include dumpster-specific data
  filter(!is.na(Dumpster)) |>
  # round the number of sports balls to the nearest integer and converts the result to an    integer variable
  mutate(Sports_Balls = as.integer(round(Sports_Balls))) |>
  # add an additional variable to keep track of Trash Wheel
  mutate(Trash_Wheel = "Mr. Trash Wheel") |>
  mutate(Year = as.numeric(Year))
```

## Read and clean the Professor Trash Wheel sheet:

```{r}
# specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
file_path <- "hw2data/202309 Trash Wheel Collection Data.xlsx"
Prof_trashwheel_data <- read_excel(file_path, sheet = "Professor Trash Wheel", skip = 1)

# use reasonable variable names
colnames(Prof_trashwheel_data) <- c("Dumpster", "Month", "Year", "Date", "Weight", 
                          "Volume", "Plastic_Bottles", "Polystyrene", 
                          "Cigarette_Butts", "Glass_Bottles", "Plastic_Bags", 
                          "Wrappers", "Homes_Powered")

Prof_trashwheel_data <- Prof_trashwheel_data |>
  # omit rows that do not include dumpster-specific data
  filter(!is.na(Dumpster)) |>
  # add an additional variable to keep track of Trash Wheel
  mutate(Trash_Wheel = "Professor Trash Wheel")
```

## Read and clean the Gwynnda Trash Wheel sheet:

```{r}
# specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
file_path <- "hw2data/202309 Trash Wheel Collection Data.xlsx"
Gwy_trashwheel_data <- read_excel(file_path, sheet = "Gwynnda Trash Wheel", skip = 1)

# use reasonable variable names
colnames(Gwy_trashwheel_data) <- c("Dumpster", "Month", "Year", "Date", "Weight", 
                          "Volume", "Plastic_Bottles", "Polystyrene", 
                          "Cigarette_Butts", "Plastic_Bags", 
                          "Wrappers", "Homes_Powered")

Gwy_trashwheel_data <- Gwy_trashwheel_data |>
  # omit rows that do not include dumpster-specific data
  filter(!is.na(Dumpster)) |>
  # add an additional variable to keep track of Trash Wheel
  mutate(Trash_Wheel = "Gwynnda Trash Wheel")
```

## Combine all datasets into a single tidy dataset:

Because different data sheets have different number of trash types, we should reformat the data structures:

```{r}
Mr_trashwheel_data <- Mr_trashwheel_data |>
 pivot_longer(
      cols = c(Plastic_Bottles, Polystyrene, Cigarette_Butts, Glass_Bottles, Plastic_Bags,                Wrappers, Sports_Balls),
      names_to = "Trash_Type",
      values_to = "Amount"
    )

Prof_trashwheel_data <- Prof_trashwheel_data |>
 pivot_longer(
      cols = c(Plastic_Bottles, Polystyrene, Cigarette_Butts, Glass_Bottles, Plastic_Bags,                Wrappers),
      names_to = "Trash_Type",
      values_to = "Amount"
    )

Gwy_trashwheel_data <- Gwy_trashwheel_data |>
 pivot_longer(
      cols = c(Plastic_Bottles, Polystyrene, Cigarette_Butts, Plastic_Bags, Wrappers),
      names_to = "Trash_Type",
      values_to = "Amount"
    )
```

After changing the data structure, we can combine the data set:

```{r}
# Check the data structure to make sure that corresponding variables in each table has the same data format:
str(Mr_trashwheel_data)
str(Prof_trashwheel_data)
str(Gwy_trashwheel_data)

# After checking, we can combine the data set
combined_data <- bind_rows(Mr_trashwheel_data, Prof_trashwheel_data, Gwy_trashwheel_data)
```

## Write a paragraph about these data:

```{r}
# Count the number of observations in the data set
num_observations <- nrow(combined_data)

num_observations

# Total weight of trash collected by Professor Trash Wheel
Prof_trashwheel_weight <- combined_data |>
  filter(Trash_Wheel == "Professor Trash Wheel") |>
  distinct(Dumpster, .keep_all = TRUE) |>
  summarize(Total_Weight = sum(Weight, na.rm = TRUE)) |>
  pull(Total_Weight)

Prof_trashwheel_weight

# Total number of cigarette butts collected by Gwynnda in June of 2022
Gwy_cigbutts_number <- combined_data |>
  filter(Trash_Wheel == "Gwynnda Trash Wheel" & 
         Trash_Type == "Cigarette_Butts" & 
         Month == "June" & 
         Year == 2022) |>
  distinct(Dumpster, .keep_all = TRUE) |>
  summarize(Total_Number = sum(Amount, na.rm = TRUE)) |>
  pull(Total_Number)

Gwy_cigbutts_number
```

The data set contains a total of 5499 observations across three trash wheels: Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda Trash Wheel (I include 5499 obs because I transform the data set to a long data table). Each observation represents a record of the amount of trash collected for various categories, such as plastic bottles, polystyrene, cigarette butts, glass bottles, and sports balls. One key variable in the data set is Weight, which records the weight of trash collected in tons. For the available data, Professor Trash Wheel collected a total of 216.26 tons of trash. Additionally, Gwynnda Trash Wheel collected 18120 cigarette butts in June of 2022.